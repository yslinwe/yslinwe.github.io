---
title: "小米路由器3刷机"
summary: 小米路由器3刷机
date: 2022-10-25
tags: ["刷机"]
author: "YSL"
draft: false
weight: 2
---

**刷机有风险**
**固件信息：**

下载固件

：http://opt.cn2qq.com/padavan/MI-3_3.4.3.9-099.trx

固件作者

：[hiboy](https://www.right.com.cn/forum/space-uid-252719.html)

固件更新

：[http://opt.cn2qq.com/](http://opt.cn2qq.com/padavan/MI-3_3.4.3.9-099.trx)
刷完后路由器信息：
路由IP：192.168.123.1
登录账号：admin
登录密码：admin
wifi：PDCN
wifi密码:1234567890

\#**工具**
putty
http://downloads.openwrt.org.cn/software/putty.zip
winscp
http://downloads.openwrt.org.cn/software/WinSCP.rar

\------------------------------
\------------------------------
\#**降级**
下载降级固件：[miwifi_r3_all_55ac7_2.11.20.bin](http://bigota.miwifi.com/xiaoqiang/rom/r3/miwifi_r3_all_55ac7_2.11.20.bin)
进入路由器后台，常用设置，系统状态，手动升级，选择降级固件，勾选清除配置
如果文件校验失败，可能文件下载不完整，重新下载。也可能是因为你的路由不是小米路由器3


\------------------------------
\------------------------------
\#**准备文件**
下载u-boot： 

![img](https://www.right.com.cn/forum/static/image/filetype/zip.gif) [uboot.zip](https://www.right.com.cn/forum/forum.php?mod=attachment&aid=MjU1ODE4fDI1Njg4ODE5fDE2NzI2ODk4NzF8MHwzNDg3ODQ%3D) *(44.09 KB, 下载次数: 3526)*


下载固件：http://opt.cn2qq.com/padavan/MI-3_3.4.3.9-099.trx
解压出

uboot.bin

，与固件

MI-3_3.4.3.9-099.trx

一起放入u盘根目录


\------------------------------
\------------------------------
\#**获取ssh**
方法1.官方方法获取
打开http://d.miwifi.com/rom/ssh
登陆后下载ssh工具，按说明使用U盘获取

方法2.漏洞法获取

登录后台，取得网址栏stok值替换到此处，然后在浏览器中访问，逐条进行

```
http://192.168.31.1/cgi-bin/luci/;stok=<你的stok值>/api/xqnetwork/set_wifi_ap?ssid=tianbao&encryption=NONE&enctype=NONE&channel=1%3Bnvram%20set%20ssh%5Fen%3D1%3B%20nvram%20commit
```


返回1616正常

```
http://192.168.31.1/cgi-bin/luci/;stok=<你的stok值>/api/xqnetwork/set_wifi_ap?ssid=tianbao&encryption=NONE&enctype=NONE&channel=1%3Bsed%20%2Di%20%22%3Ax%3AN%3As%2Fif%20%5C%5B%2E%2A%5C%3B%20then%5Cn%2E%2Areturn%200%5Cn%2E%2Afi%2F%23tb%2F%3Bb%20x%22%20%2Fetc%2Finit.d%2Fdropbear
```

返回1616正常

```
http://192.168.31.1/cgi-bin/luci/;stok=<你的stok值>/api/xqnetwork/set_wifi_ap?ssid=tianbao&encryption=NONE&enctype=NONE&channel=1%3B%2Fetc%2Finit.d%2Fdropbear%20start
```

返回1616正常

putty登录时，密码为web管理密码，或root密码
root密码在此处查看：http://d.miwifi.com/rom/ssh

如果都无法登录，请尝试更改密码

```
http://192.168.31.1/cgi-bin/luci/;stok=<你的stok值>/api/xqsystem/set_name_password?oldPwd=<你当前的后台管理密码>&newPwd=<新密码>
```




\------------------------------
\------------------------------
\#**备份固件**

插入U盘，输入df -h
看到Size是自己的u盘大小那一行，再看Mounted on的对应路径
比如：/extdisks/sda1
进入U盘根目录：cd /extdisks/sda1
putty登录路由器
查看分区如下，命令：cat /proc/mtd

root@XiaoQiang:~# cat /proc/mtd

```
dev:  size  erasesize name

mtd0: 08000000 00020000 "ALL"

mtd1: 00040000 00020000 "Bootloader"

mtd2: 00040000 00020000 "Config"

mtd3: 00040000 00020000 "Bdata"

mtd4: 00040000 00020000 "Factory"

mtd5: 00040000 00020000 "crash"

mtd6: 00040000 00020000 "crash_syslog"

mtd7: 00080000 00020000 "reserved0"

mtd8: 00400000 00020000 "kernel0"

mtd9: 00400000 00020000 "kernel1"

mtd10: 02000000 00020000 "rootfs0"

mtd11: 02000000 00020000 "rootfs1"

mtd12: 03600000 00020000 "overlay"
```







putty中执行备份命令（0-12），备份至U盘/extdisks/sda1目录

```
dd if=/dev/mtd0 of=mtd0.bin

dd if=/dev/mtd1 of=mtd1.bin

dd if=/dev/mtd2 of=mtd2.bin

dd if=/dev/mtd3 of=mtd3.bin

dd if=/dev/mtd4 of=mtd4.bin

dd if=/dev/mtd5 of=mtd5.bin

dd if=/dev/mtd6 of=mtd6.bin

dd if=/dev/mtd7 of=mtd7.bin

dd if=/dev/mtd8 of=mtd8.bin

dd if=/dev/mtd9 of=mtd9.bin

dd if=/dev/mtd10 of=mtd10.bin

dd if=/dev/mtd11 of=mtd11.bin

dd if=/dev/mtd12 of=mtd12.bin
```




没有u盘的可以备份至tmp目录，使用winscp下载，协议选择scp
\------------------------------
\------------------------------
\#**刷入u-boot**
执行以下命令

```
nvram set boot_wait=on

nvram set uart_en=1

nvram commit

mtd write uboot.bin Bootloader
```




\------------------------------
\------------------------------
\#**刷入固件**
执行以下命令

```
dd if=MI-3_3.4.3.9-099.trx bs=4194304 count=1 2> /dev/null | dd of=MI-3_3.4.3.9-099.trx.part1 2> /dev/null

dd if=MI-3_3.4.3.9-099.trx bs=4194304 skip=1 2> /dev/null | dd of=MI-3_3.4.3.9-099.trx.part2 2> /dev/null

mtd write MI-3_3.4.3.9-099.trx.part1 kernel1

mtd write MI-3_3.4.3.9-099.trx.part2 rootfs0

nvram set flag_last_success=1

nvram commit
```





写入后可以验证一下md5

```
mtd verify MI-3_3.4.3.9-099.trx.part1 kernel1

mtd verify MI-3_3.4.3.9-099.trx.part2 rootfs0
```







写入part1或part2时出错，显示[e]，执行以下语句，并用u盘刷官方固件

```
nvram set flag_last_success=0

nvram set flag_try_sys1_failed=1

nvram set flag_try_sys2_failed=1

nvram commit
```



\------------------------------
\------------------------------
\#**重启路由**
在putty中执行命令

reboot




不成功则断电重启

\------------------------------
\------------------------------
\#**附：检查md5命令**

md5sum 文件名


简单的说，有u盘，刷开发版，获取ssh，u盘内准备好要刷的u-boot和padavan固件插到路由器上，备份分区至u盘，然后刷入u-boot和固件，重启即可

手动刷机过程中，一定要验证MD5，否则容易变砖

\------------------------------
\------------------------------
\#**刷回官方**
方法来自：[fyi2000](https://www.right.com.cn/forum/space-uid-448988.html) https://www.right.com.cn/forum/thread-706545-1-1.html

注意：tmp目录空间一般较小，推荐使用U盘，在u盘目录下操作

```
cd /extdisks/sda1

wget -O - http://bigota.miwifi.com/xiaoqiang/rom/r3/miwifi_r3_all_55ac7_2.11.20.bin| dd of=kernel0.bin bs=1 skip=94108 count=2284584

cat kernel0.md5

62e96a64e21de9b176fd51336b963e2c kernel0.bin

EOF

md5sum -cw kernel0.md5 && mtd_write write kernel0.bin Firmware_Stub
```





完成后按照官方U盘刷机教程刷机

# U盘刷机

1.下载官方固件，命名为miwifi.bin,放在u盘根目录

2.路由器断电，插上u盘

3.按住reset，可以使用牙签等，注意是按住

4.路由器插电，等待黄灯慢闪的时候松开，刷机完成会自动重启