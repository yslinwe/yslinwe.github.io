---
title: "PVE系统直通硬盘"
summary: PVE系统直通硬盘
date: 2025-04-17
tags: ["PVE系统直通硬盘"]
author: "YSL"
draft: false
weight: 2
---

PVE系统直通硬盘有两种方式，
1.方法一命令操作，映射直通单块硬盘；
2.方法二添加 PCI设备，直通 SATA Controller(SATA 控制器)。

###### 方法一：命令操作，直通单块硬盘

进入Proxmox VE(PVE)系统的SSH，或直接进入PVE管理网页Shell

查看磁盘ID
输入命令，列出PVE系统下所有的磁盘存储设备并查看磁盘ID序列号。

```
ls -l /dev/disk/by-id/
```

[![img](https://icn.ink/usr/uploads/2023/01/202301291316283205705.png)](https://icn.ink/usr/uploads/2023/01/202301291316283205705.png)



PVE系统查看磁盘详细信息及确定磁盘信息
注：ata、mmc等…表示接口方式，通常有ATA、SATA、SCS、NVME、eMMC和SASI等类型。IDE和SATA接口一般为“ata”，SCSI及SAS接口一般为”scsi“。
导入虚拟机



```
qm set <vm_id> –<disk_type>[n] /dev/disk/by-id/<type>-$brand-$model_$serial_number
```

**<vm_id>** : 为创建虚拟机时指定的VM ID。
**<disk_type>[n]**： 导入后的磁盘的总线类型及其编号，总线类型可以选择IDE、SATA、VirtIO Block和SCSI类型，编号从0开始，最大值根据总线接口类型有所不同，IDE为3，SATA为5，VirTIO Block为15，SCSI为13。
**/dev/disk/by-id/-brand-brand−model_$serial_number** ： 为磁盘ID的具体路径和名称。
按照我硬盘的参数举例：

如上方的硬盘数据 **ata-ST4000VX000-2AG166_ZGY163KG** 为例，将此硬盘直通给VM ID编号为102的虚拟机下，总线类型接口为sata2（请根据PVE虚拟机下的总线编号设置）

```
qm set 102 -sata2 /dev/disk/by-id/ata-ST4000VX000-2AG166_ZGY163KG
```

[![img](https://icn.ink/usr/uploads/2023/01/202301291327336498114.png)](https://icn.ink/usr/uploads/2023/01/202301291327336498114.png)



有返回信息



```
update VM 102: -sata2 /dev/disk/by-id/ata-ST4000VX000-2AG166_ZGY163KG
```

为直通成功。

###### 方法二：添加 PCI设备，直通 SATA Controller（SATA 控制器）

Proxmox VE(PVE)系统直通SATA Controller(SATA 控制器)，会把整个sata总线全部直通过去，就是直接将南桥或者直接把北桥连接的sata总线直通，那么有些主板sata接口就会全部被直通。

注意：如果您的PVE系统是安装在SATA的硬盘中，会导致PVE系统无法启动，所以在直通 SATA Controller(SATA 控制器)，之前请先确认自己的PVE系统安装位置，或者直接将系统安装在 NVMe 硬盘中。
在开始之前请先查看《 Proxmox VE(PVE)系统开启IOMMU功能实现硬件直通》文章，开启IOMMU硬件直通功能后，执行下一步添加 SATA Controller（SATA 控制器）操作。

选择需要设置的PVE系统，点击 硬件 > 添加 > PCI设备 > 选择 SATA Controller（SATA 控制器），最后点击“添加”把 SATA Controller（SATA 控制器）添加给相应的系统后，完成重启，PVE硬件直通的设置就生效了。
[![img](https://icn.ink/usr/uploads/2023/01/202301291333263846893.png)](https://icn.ink/usr/uploads/2023/01/202301291333263846893.png)